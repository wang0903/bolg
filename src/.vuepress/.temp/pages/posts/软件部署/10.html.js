export const data = JSON.parse("{\"key\":\"v-2be64f7d\",\"path\":\"/posts/%E8%BD%AF%E4%BB%B6%E9%83%A8%E7%BD%B2/10.html\",\"title\":\"xtrabackup备份MySQL数据库\",\"lang\":\"zh-CN\",\"frontmatter\":{\"cover\":\"/assets/images/cover2.jpg\",\"icon\":\"pen-to-square\",\"date\":\"2024-06-14T00:00:00.000Z\",\"category\":[\"编写备份脚本\"],\"tag\":[\"xtrabackup\",\"备份\"],\"star\":true,\"sticky\":true,\"description\":\"xtrabackup备份MySQL数据库 备份脚本 backup.sh #!/bin/bash # 设置变量 BACKUP_DIR=\\\"/home/tg/xtrabackup/backups\\\" #这个是宿主机的路径 MYSQL_USER=\\\"root\\\" MYSQL_PASSWORD=\\\"rootpassword\\\" MYSQL_DATA_DIR=\\\"/var/lib/mysql\\\" FULL_BACKUP_DIR=\\\"$BACKUP_DIR/full_backup\\\" INC_BACKUP_DIR=\\\"$BACKUP_DIR/inc_backup\\\" LOG_FILE=\\\"$BACKUP_DIR/backup.log\\\" TIMESTAMP=$(date +\\\"%F_%T\\\") # 日志记录函数 log() { echo \\\"[$TIMESTAMP] $1\\\" | tee -a $LOG_FILE } # 函数：进行全量备份 full_backup() { log \\\"开始全量备份...\\\" FULL_BACKUP_SUBDIR=\\\"$FULL_BACKUP_DIR/$(date +\\\"%Y-%m-%d\\\")\\\" rm -rf $FULL_BACKUP_SUBDIR xtrabackup --backup --target-dir=$FULL_BACKUP_SUBDIR --datadir=$MYSQL_DATA_DIR --user=$MYSQL_USER --password=$MYSQL_PASSWORD 2&gt;&gt; $LOG_FILE if [ $? -eq 0 ]; then log \\\"全量备份完成\\\" else log \\\"全量备份失败\\\" fi } # 函数：进行增量备份 incremental_backup() { log \\\"开始增量备份...\\\" INC_BACKUP_SUBDIR=\\\"$INC_BACKUP_DIR/$(date +\\\"%Y-%m-%d_%H-%M-%S\\\")\\\" LAST_FULL_BACKUP=$(ls -td $FULL_BACKUP_DIR/* | head -n 1) rm -rf $INC_BACKUP_SUBDIR xtrabackup --backup --target-dir=$INC_BACKUP_SUBDIR --incremental-basedir=$LAST_FULL_BACKUP --datadir=$MYSQL_DATA_DIR --user=$MYSQL_USER --password=$MYSQL_PASSWORD 2&gt;&gt; $LOG_FILE if [ $? -eq 0 ]; then log \\\"增量备份完成\\\" else log \\\"增量备份失败\\\" fi } # 函数：删除旧的备份 cleanup_old_backups() { log \\\"删除超过5天的全量备份...\\\" find $FULL_BACKUP_DIR -maxdepth 1 -type d -mtime +5 -exec rm -rf {} \\\\; log \\\"旧的全量备份已删除\\\" } # 检查当前是星期几 DAY_OF_WEEK=$(date +\\\"%u\\\") # 如果是周日进行全量备份，其余时间进行增量备份 if [ \\\"$DAY_OF_WEEK\\\" -eq 7 ]; then full_backup cleanup_old_backups else incremental_backup fi\",\"head\":[[\"meta\",{\"property\":\"og:url\",\"content\":\"https://github.com/posts/%E8%BD%AF%E4%BB%B6%E9%83%A8%E7%BD%B2/10.html\"}],[\"meta\",{\"property\":\"og:title\",\"content\":\"xtrabackup备份MySQL数据库\"}],[\"meta\",{\"property\":\"og:description\",\"content\":\"xtrabackup备份MySQL数据库 备份脚本 backup.sh #!/bin/bash # 设置变量 BACKUP_DIR=\\\"/home/tg/xtrabackup/backups\\\" #这个是宿主机的路径 MYSQL_USER=\\\"root\\\" MYSQL_PASSWORD=\\\"rootpassword\\\" MYSQL_DATA_DIR=\\\"/var/lib/mysql\\\" FULL_BACKUP_DIR=\\\"$BACKUP_DIR/full_backup\\\" INC_BACKUP_DIR=\\\"$BACKUP_DIR/inc_backup\\\" LOG_FILE=\\\"$BACKUP_DIR/backup.log\\\" TIMESTAMP=$(date +\\\"%F_%T\\\") # 日志记录函数 log() { echo \\\"[$TIMESTAMP] $1\\\" | tee -a $LOG_FILE } # 函数：进行全量备份 full_backup() { log \\\"开始全量备份...\\\" FULL_BACKUP_SUBDIR=\\\"$FULL_BACKUP_DIR/$(date +\\\"%Y-%m-%d\\\")\\\" rm -rf $FULL_BACKUP_SUBDIR xtrabackup --backup --target-dir=$FULL_BACKUP_SUBDIR --datadir=$MYSQL_DATA_DIR --user=$MYSQL_USER --password=$MYSQL_PASSWORD 2&gt;&gt; $LOG_FILE if [ $? -eq 0 ]; then log \\\"全量备份完成\\\" else log \\\"全量备份失败\\\" fi } # 函数：进行增量备份 incremental_backup() { log \\\"开始增量备份...\\\" INC_BACKUP_SUBDIR=\\\"$INC_BACKUP_DIR/$(date +\\\"%Y-%m-%d_%H-%M-%S\\\")\\\" LAST_FULL_BACKUP=$(ls -td $FULL_BACKUP_DIR/* | head -n 1) rm -rf $INC_BACKUP_SUBDIR xtrabackup --backup --target-dir=$INC_BACKUP_SUBDIR --incremental-basedir=$LAST_FULL_BACKUP --datadir=$MYSQL_DATA_DIR --user=$MYSQL_USER --password=$MYSQL_PASSWORD 2&gt;&gt; $LOG_FILE if [ $? -eq 0 ]; then log \\\"增量备份完成\\\" else log \\\"增量备份失败\\\" fi } # 函数：删除旧的备份 cleanup_old_backups() { log \\\"删除超过5天的全量备份...\\\" find $FULL_BACKUP_DIR -maxdepth 1 -type d -mtime +5 -exec rm -rf {} \\\\; log \\\"旧的全量备份已删除\\\" } # 检查当前是星期几 DAY_OF_WEEK=$(date +\\\"%u\\\") # 如果是周日进行全量备份，其余时间进行增量备份 if [ \\\"$DAY_OF_WEEK\\\" -eq 7 ]; then full_backup cleanup_old_backups else incremental_backup fi\"}],[\"meta\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"meta\",{\"property\":\"og:image\",\"content\":\"https://github.com/assets/images/cover2.jpg\"}],[\"meta\",{\"property\":\"og:locale\",\"content\":\"zh-CN\"}],[\"meta\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"meta\",{\"name\":\"twitter:image:alt\",\"content\":\"xtrabackup备份MySQL数据库\"}],[\"meta\",{\"property\":\"article:author\",\"content\":\"小辣椒\"}],[\"meta\",{\"property\":\"article:tag\",\"content\":\"xtrabackup\"}],[\"meta\",{\"property\":\"article:tag\",\"content\":\"备份\"}],[\"meta\",{\"property\":\"article:published_time\",\"content\":\"2024-06-14T00:00:00.000Z\"}],[\"script\",{\"type\":\"application/ld+json\"},\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Article\\\",\\\"headline\\\":\\\"xtrabackup备份MySQL数据库\\\",\\\"image\\\":[\\\"https://github.com/assets/images/cover2.jpg\\\"],\\\"datePublished\\\":\\\"2024-06-14T00:00:00.000Z\\\",\\\"dateModified\\\":null,\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"小辣椒\\\",\\\"url\\\":\\\"https://mister-hope.com\\\"}]}\"]]},\"headers\":[{\"level\":3,\"title\":\"2. 编写恢复备份脚本\",\"slug\":\"_2-编写恢复备份脚本\",\"link\":\"#_2-编写恢复备份脚本\",\"children\":[]},{\"level\":3,\"title\":\"3. 更新 Docker Compose 文件\",\"slug\":\"_3-更新-docker-compose-文件\",\"link\":\"#_3-更新-docker-compose-文件\",\"children\":[]},{\"level\":3,\"title\":\"4. 设置计划任务\",\"slug\":\"_4-设置计划任务\",\"link\":\"#_4-设置计划任务\",\"children\":[]},{\"level\":3,\"title\":\"5. 启动容器并验证\",\"slug\":\"_5-启动容器并验证\",\"link\":\"#_5-启动容器并验证\",\"children\":[]}],\"readingTime\":{\"minutes\":2.67,\"words\":800},\"filePathRelative\":\"posts/软件部署/10.md\",\"localizedDate\":\"2024年6月14日\",\"excerpt\":\"<h1> xtrabackup备份MySQL数据库</h1>\\n<h4> 备份脚本 <code>backup.sh</code></h4>\\n<div class=\\\"language-bash line-numbers-mode\\\" data-ext=\\\"sh\\\"><pre class=\\\"language-bash\\\"><code><span class=\\\"token shebang important\\\">#!/bin/bash</span>\\n\\n<span class=\\\"token comment\\\"># 设置变量</span>\\n<span class=\\\"token assign-left variable\\\">BACKUP_DIR</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"/home/tg/xtrabackup/backups\\\"</span> <span class=\\\"token comment\\\">#这个是宿主机的路径</span>\\n<span class=\\\"token assign-left variable\\\">MYSQL_USER</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"root\\\"</span>\\n<span class=\\\"token assign-left variable\\\">MYSQL_PASSWORD</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"rootpassword\\\"</span>\\n<span class=\\\"token assign-left variable\\\">MYSQL_DATA_DIR</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"/var/lib/mysql\\\"</span>\\n<span class=\\\"token assign-left variable\\\">FULL_BACKUP_DIR</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$BACKUP_DIR</span>/full_backup\\\"</span>\\n<span class=\\\"token assign-left variable\\\">INC_BACKUP_DIR</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$BACKUP_DIR</span>/inc_backup\\\"</span>\\n<span class=\\\"token assign-left variable\\\">LOG_FILE</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$BACKUP_DIR</span>/backup.log\\\"</span>\\n<span class=\\\"token assign-left variable\\\">TIMESTAMP</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span><span class=\\\"token function\\\">date</span> +<span class=\\\"token string\\\">\\\"%F_%T\\\"</span><span class=\\\"token variable\\\">)</span></span>\\n\\n<span class=\\\"token comment\\\"># 日志记录函数</span>\\n<span class=\\\"token function-name function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token builtin class-name\\\">echo</span> <span class=\\\"token string\\\">\\\"[<span class=\\\"token variable\\\">$TIMESTAMP</span>] <span class=\\\"token variable\\\">$1</span>\\\"</span> <span class=\\\"token operator\\\">|</span> <span class=\\\"token function\\\">tee</span> <span class=\\\"token parameter variable\\\">-a</span> <span class=\\\"token variable\\\">$LOG_FILE</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token comment\\\"># 函数：进行全量备份</span>\\n<span class=\\\"token function-name function\\\">full_backup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    log <span class=\\\"token string\\\">\\\"开始全量备份...\\\"</span>\\n    <span class=\\\"token assign-left variable\\\">FULL_BACKUP_SUBDIR</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$FULL_BACKUP_DIR</span>/<span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span><span class=\\\"token function\\\">date</span> +<span class=\\\"token string\\\">\\\"%Y-%m-%d\\\"</span><span class=\\\"token variable\\\">)</span></span>\\\"</span>\\n    <span class=\\\"token function\\\">rm</span> <span class=\\\"token parameter variable\\\">-rf</span> <span class=\\\"token variable\\\">$FULL_BACKUP_SUBDIR</span>\\n    xtrabackup <span class=\\\"token parameter variable\\\">--backup</span> --target-dir<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$FULL_BACKUP_SUBDIR</span> <span class=\\\"token parameter variable\\\">--datadir</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$MYSQL_DATA_DIR</span> <span class=\\\"token parameter variable\\\">--user</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$MYSQL_USER</span> <span class=\\\"token parameter variable\\\">--password</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$MYSQL_PASSWORD</span> <span class=\\\"token operator\\\"><span class=\\\"token file-descriptor important\\\">2</span>&gt;&gt;</span> <span class=\\\"token variable\\\">$LOG_FILE</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">[</span> <span class=\\\"token variable\\\">$?</span> <span class=\\\"token parameter variable\\\">-eq</span> <span class=\\\"token number\\\">0</span> <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token keyword\\\">then</span>\\n        log <span class=\\\"token string\\\">\\\"全量备份完成\\\"</span>\\n    <span class=\\\"token keyword\\\">else</span>\\n        log <span class=\\\"token string\\\">\\\"全量备份失败\\\"</span>\\n    <span class=\\\"token keyword\\\">fi</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token comment\\\"># 函数：进行增量备份</span>\\n<span class=\\\"token function-name function\\\">incremental_backup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    log <span class=\\\"token string\\\">\\\"开始增量备份...\\\"</span>\\n    <span class=\\\"token assign-left variable\\\">INC_BACKUP_SUBDIR</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$INC_BACKUP_DIR</span>/<span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span><span class=\\\"token function\\\">date</span> +<span class=\\\"token string\\\">\\\"%Y-%m-%d_%H-%M-%S\\\"</span><span class=\\\"token variable\\\">)</span></span>\\\"</span>\\n    <span class=\\\"token assign-left variable\\\">LAST_FULL_BACKUP</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span><span class=\\\"token function\\\">ls</span> <span class=\\\"token parameter variable\\\">-td</span> $FULL_BACKUP_DIR/* <span class=\\\"token operator\\\">|</span> <span class=\\\"token function\\\">head</span> <span class=\\\"token parameter variable\\\">-n</span> <span class=\\\"token number\\\">1</span><span class=\\\"token variable\\\">)</span></span>\\n    <span class=\\\"token function\\\">rm</span> <span class=\\\"token parameter variable\\\">-rf</span> <span class=\\\"token variable\\\">$INC_BACKUP_SUBDIR</span>\\n    xtrabackup <span class=\\\"token parameter variable\\\">--backup</span> --target-dir<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$INC_BACKUP_SUBDIR</span> --incremental-basedir<span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$LAST_FULL_BACKUP</span> <span class=\\\"token parameter variable\\\">--datadir</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$MYSQL_DATA_DIR</span> <span class=\\\"token parameter variable\\\">--user</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$MYSQL_USER</span> <span class=\\\"token parameter variable\\\">--password</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$MYSQL_PASSWORD</span> <span class=\\\"token operator\\\"><span class=\\\"token file-descriptor important\\\">2</span>&gt;&gt;</span> <span class=\\\"token variable\\\">$LOG_FILE</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">[</span> <span class=\\\"token variable\\\">$?</span> <span class=\\\"token parameter variable\\\">-eq</span> <span class=\\\"token number\\\">0</span> <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token keyword\\\">then</span>\\n        log <span class=\\\"token string\\\">\\\"增量备份完成\\\"</span>\\n    <span class=\\\"token keyword\\\">else</span>\\n        log <span class=\\\"token string\\\">\\\"增量备份失败\\\"</span>\\n    <span class=\\\"token keyword\\\">fi</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token comment\\\"># 函数：删除旧的备份</span>\\n<span class=\\\"token function-name function\\\">cleanup_old_backups</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    log <span class=\\\"token string\\\">\\\"删除超过5天的全量备份...\\\"</span>\\n    <span class=\\\"token function\\\">find</span> <span class=\\\"token variable\\\">$FULL_BACKUP_DIR</span> <span class=\\\"token parameter variable\\\">-maxdepth</span> <span class=\\\"token number\\\">1</span> <span class=\\\"token parameter variable\\\">-type</span> d <span class=\\\"token parameter variable\\\">-mtime</span> +5 <span class=\\\"token parameter variable\\\">-exec</span> <span class=\\\"token function\\\">rm</span> <span class=\\\"token parameter variable\\\">-rf</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span> <span class=\\\"token punctuation\\\">\\\\</span><span class=\\\"token punctuation\\\">;</span>\\n    log <span class=\\\"token string\\\">\\\"旧的全量备份已删除\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token comment\\\"># 检查当前是星期几</span>\\n<span class=\\\"token assign-left variable\\\">DAY_OF_WEEK</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span><span class=\\\"token function\\\">date</span> +<span class=\\\"token string\\\">\\\"%u\\\"</span><span class=\\\"token variable\\\">)</span></span>\\n\\n<span class=\\\"token comment\\\"># 如果是周日进行全量备份，其余时间进行增量备份</span>\\n<span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">[</span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$DAY_OF_WEEK</span>\\\"</span> <span class=\\\"token parameter variable\\\">-eq</span> <span class=\\\"token number\\\">7</span> <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token keyword\\\">then</span>\\n    full_backup\\n    cleanup_old_backups\\n<span class=\\\"token keyword\\\">else</span>\\n    incremental_backup\\n<span class=\\\"token keyword\\\">fi</span>\\n</code></pre><div class=\\\"line-numbers\\\" aria-hidden=\\\"true\\\"><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div></div></div>\",\"autoDesc\":true}")

if (import.meta.webpackHot) {
  import.meta.webpackHot.accept()
  if (__VUE_HMR_RUNTIME__.updatePageData) {
    __VUE_HMR_RUNTIME__.updatePageData(data)
  }
}

if (import.meta.hot) {
  import.meta.hot.accept(({ data }) => {
    __VUE_HMR_RUNTIME__.updatePageData(data)
  })
}
